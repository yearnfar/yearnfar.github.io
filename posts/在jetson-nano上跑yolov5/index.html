<!doctype html><html><head><title>在Jetson Nano上跑yolov5</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content="在Jetson Nano设备上，搭建PyTorch环境，并运行yolov5项目。"><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><meta property="og:title" content="在Jetson Nano上跑yolov5"><meta property="og:description" content="在Jetson Nano设备上，搭建PyTorch环境，并运行yolov5项目。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.yearnfar.com/posts/%E5%9C%A8jetson-nano%E4%B8%8A%E8%B7%91yolov5/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-22T18:16:32+08:00"><meta property="article:modified_time" content="2022-05-22T18:16:32+08:00"><meta property="og:site_name" content="My Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="在Jetson Nano上跑yolov5"><meta name=twitter:description content="在Jetson Nano设备上，搭建PyTorch环境，并运行yolov5项目。"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QBPX79CYCP"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QBPX79CYCP',{anonymize_ip:!1})}</script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href=https://blog.yearnfar.com/scss/journal.min.0f46f98b723f2aad4b02d9370bb6aa7848b5c2b2a5579642014082283683d2d8.css integrity="sha256-D0b5i3I/Kq1LAtk3C7aqeEi1wrKlV5ZCAUCCKDaD0tg=" media=screen><link rel=stylesheet href=https://blog.yearnfar.com/scss/dark-mode.min.79c34391dbcff20df8b4dac718e2606701efcbfdb9f3b08447ac39ac9dc7b463.css integrity="sha256-ecNDkdvP8g34tNrHGOJgZwHvy/2587CER6w5rJ3HtGM=" media=screen><script src=/vendor/js/loadCSS.js></script><script>loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons")</script><script src=/js/toc.js></script></head><body><div id=app><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://blog.yearnfar.com><div class=nav-title>知识时光机</div><div class=nav-subtitle>仰望星空，脚踏实地</div></a><div class=nav-link-list><a class="a-block nav-link-item false" href=/about>关于／About</a>
<a class="a-block nav-link-item active" href=/posts>归档／Archive</a>
<a class="a-block nav-link-item false" href=/tags>标签／Tags</a>
<a class="a-block nav-link-item false" href="https://www.ecosia.org/search?q=site:blog.yearnfar.com">搜索／Search</a>
<a class="a-block nav-link-item false" href=/index.xml>订阅／RSS</a></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>移植自 <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
yearnfar 2022</div></div><div id=extraContainer class=extra-container><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#jetson-naon%e6%90%ad%e5%bb%ba onclick="onNavClick(`#jetson-naon搭建-nav`)" id=jetson-naon搭建-nav>Jetson Naon搭建</a></li><li><a href=#%e5%87%86%e5%a4%87python onclick="onNavClick(`#准备python-nav`)" id=准备python-nav>准备Python</a></li><li><a href=#%e5%ae%89%e8%a3%85pytorch onclick="onNavClick(`#安装pytorch-nav`)" id=安装pytorch-nav>安装PyTorch</a></li><li><a href=#%e5%ae%89%e8%a3%85torversion onclick="onNavClick(`#安装torversion-nav`)" id=安装torversion-nav>安装torversion</a></li><li><a href=#%e5%ae%89%e8%a3%85yolov5 onclick="onNavClick(`#安装yolov5-nav`)" id=安装yolov5-nav>安装Yolov5</a></li></ul></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a>
<a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item false" href=/about>关于／About</a>
<a class="a-block drawer-menu-item active" href=/posts>归档／Archive</a>
<a class="a-block drawer-menu-item false" href=/tags>标签／Tags</a>
<a class="a-block drawer-menu-item false" href="https://www.ecosia.org/search?q=site:blog.yearnfar.com">搜索／Search</a>
<a class="a-block drawer-menu-item false" href=/index.xml>订阅／RSS</a><div class=toc><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#jetson-naon%e6%90%ad%e5%bb%ba onclick="onNavClick(`#jetson-naon搭建-nav`)" id=jetson-naon搭建-nav>Jetson Naon搭建</a></li><li><a href=#%e5%87%86%e5%a4%87python onclick="onNavClick(`#准备python-nav`)" id=准备python-nav>准备Python</a></li><li><a href=#%e5%ae%89%e8%a3%85pytorch onclick="onNavClick(`#安装pytorch-nav`)" id=安装pytorch-nav>安装PyTorch</a></li><li><a href=#%e5%ae%89%e8%a3%85torversion onclick="onNavClick(`#安装torversion-nav`)" id=安装torversion-nav>安装torversion</a></li><li><a href=#%e5%ae%89%e8%a3%85yolov5 onclick="onNavClick(`#安装yolov5-nav`)" id=安装yolov5-nav>安装Yolov5</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu</i></button>
<a id=navTitle class=navbar-brand href=https://blog.yearnfar.com>知识时光机</a>
<button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://blog.yearnfar.com><div class=single-column-header-title>知识时光机</div><div class=single-column-header-subtitle>仰望星空，脚踏实地</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper style=background-image:url(https://cdn.yearnfar.com/blog/22/05/491ccebbdafadababd79947566ffbb7b.jpg)><div class=post-title>在Jetson Nano上跑yolov5<div class=post-subtitle>在Jetson Nano设备上，搭建PyTorch环境，并运行yolov5项目。</div><div class=post-meta><time itemprop=datePublished>2022-05-22 18:16</time>
<i class=material-icons>folder</i>
<a href=/categories/jetson-nano>jetson-nano</a>
&nbsp;
<i class=material-icons>label</i>
<a href=/tags/jetson-nano>jetson nano</a>
&nbsp;
<a href=/tags/yolov5>yolov5</a>
&nbsp;</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><h2 id=jetson-naon搭建>Jetson Naon搭建</h2><p>参考官方文档：<a href=https://developer.nvidia.com/zh-cn/embedded/learn/get-started-jetson-nano-devkit>Jetson Nano 开发者套件入门</a></p><p>按照官方文档搭建好Jetson Nano环境后，可以看到/usr/local/cuda目录，将CUDA加入环境变量：</p><div class=highlight><pre style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#658b00>export</span> <span style=color:#00688b>CUDA_HOME</span>=/usr/local/cuda
<span style=color:#658b00>export</span> <span style=color:#00688b>PATH</span>=<span style=color:#00688b>$CUDA_HOME</span>/bin:<span style=color:#00688b>$PATH</span>
<span style=color:#658b00>export</span> <span style=color:#00688b>LD_LIBRARY_PATH</span>=<span style=color:#00688b>$CUDA_HOME</span>/lib64:<span style=color:#00688b>$LD_LIBRARY_PATH</span>
</code></pre></div><p>查看CUDA信息</p><div class=highlight><pre style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>➜  ~ nvcc -V
nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2021 NVIDIA Corporation
Built on Sun_Feb_28_22:34:44_PST_2021
Cuda compilation tools, release 10.2, V10.2.300
Build cuda_10.2_r440.TC440_70.29663091_0
</code></pre></div><h2 id=准备python>准备Python</h2><p>以前一直使用Anaconda管理Python环境，但是在Jetson Nano安装Anaconda或Miniconda时都出现了"core dumped"，最后发现了miniforge 这个项目。</p><p>我这里安装的是4.12.0版本：<a href=https://github.com/conda-forge/miniforge/releases/download/4.12.0-0/Mambaforge-4.12.0-0-Linux-aarch64.sh>Mambaforge-Linux-aarch64.sh</a></p><div class=highlight><pre style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>➜  ~ sudo ./Mambaforge-Linux-aarch64.sh
</code></pre></div><p>安装好Mamba后就是创建Python环境了。</p><p>因为PyTorch官方不提供ARM aarch64架构的CUDA版本，所以我下载Nvida官网编译好的二进制包。目前提供PyTorch1.0.0 ~ PyTorch1.12.0 总计13个版本可供选择。</p><p><a href=https://forums.developer.nvidia.com/t/pytorch-for-jetson-version-1-11-now-available/72048>PyTorch for Jetson</a></p><p>怎么选择PyTorch版本呢？我们可以看到不同的PyTorch版本对JetPack版本要求是不一样，先查看Jetson Nano的JetPack版本。</p><div class=highlight><pre style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>➜  ~ cat /etc/nv_tegra_release
<span style=color:#228b22># R32 (release), REVISION: 7.2, GCID: 30192233, BOARD: t210ref, EABI: aarch64, DATE: Wed Apr 20 21:34:48 UTC 2022</span>
</code></pre></div><p>可以看到默认安装的是JetPack R32，JetPack R32支持的PyTorch最高的版本是v1.10.0，对应的Python版本是3.6。</p><p><img src=https://cdn.yearnfar.com/blog/22/05/f2797550a253297f6de428e927cd81ed.jpg alt=nvidia></p><p>创建Python3.6环境：</p><div class=highlight><pre style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>mamba create -n yolov5 <span style=color:#00688b>python</span>=3.6
</code></pre></div><h2 id=安装pytorch>安装PyTorch</h2><p>下载<a href=https://developer.nvidia.com/zh-cn/embedded/learn/get-started-jetson-nano-devkit>PyTorch</a>，并运行下面命令安装。</p><div class=highlight><pre style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sudo apt-get install libopenblas-base libopenmpi-dev libomp-dev
pip install Cython
pip install torch-1.10.0-cp36-cp36m-linux_aarch64.whl
</code></pre></div><p>检查PyTorch安装情况：</p><div class=highlight><pre style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>(yolov5) ➜  python
Python 3.6.15 | packaged by conda-forge | (default, Dec  <span style=color:#b452cd>3</span> 2021, 19:12:04)
[GCC 9.4.0] on linux
Type <span style=color:#cd5555>&#34;help&#34;</span>, <span style=color:#cd5555>&#34;copyright&#34;</span>, <span style=color:#cd5555>&#34;credits&#34;</span> or <span style=color:#cd5555>&#34;license&#34;</span> <span style=color:#8b008b;font-weight:700>for</span> more information.
&gt;&gt;&gt; import torch
&gt;&gt;&gt; print(torch.cuda.is_available())
True
&gt;&gt;&gt; print(torch.backends.cudnn.version())
<span style=color:#b452cd>8201</span>
</code></pre></div><h2 id=安装torversion>安装torversion</h2><p>因为PyTorch选择的是v1.10.0，所以torchvision需要安装版本0.11.0。因为torchvision依赖pillow，安装时默认会安装最新的pillow。但是最新的pillow会产生其他问题，所以这里先安装好pillow版本8.4.0。</p><p><a href=https://github.com/pytorch/vision>Torchvision项目地址</a></p><p>先安装依赖</p><div class=highlight><pre style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>(yolov5) ➜  ~ sudo apt-get install libjpeg8 libjpeg62-dev libfreetype6 libfreetype6-dev
(yolov5) ➜  ~ pip install <span style=color:#00688b>pillow</span>==8.4.0
</code></pre></div><p>下载torchvision源码，并安装：</p><div class=highlight><pre style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>python setup.py install
</code></pre></div><p>检查torchvision安装情况：</p><div class=highlight><pre style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>(yolov5) ➜  ~ python
Python 3.6.15 | packaged by conda-forge | (default, Dec  <span style=color:#b452cd>3</span> 2021, 19:12:04)
[GCC 9.4.0] on linux
Type <span style=color:#cd5555>&#34;help&#34;</span>, <span style=color:#cd5555>&#34;copyright&#34;</span>, <span style=color:#cd5555>&#34;credits&#34;</span> or <span style=color:#cd5555>&#34;license&#34;</span> <span style=color:#8b008b;font-weight:700>for</span> more information.
&gt;&gt;&gt; import torchvision
&gt;&gt;&gt; print(torchvision.__version__)
0.11.0a0
</code></pre></div><h2 id=安装yolov5>安装Yolov5</h2><p><a href=https://github.com/ultralytics/yolov5>Yolov5项目地址</a></p><p>下载项目源码，并安装依赖：</p><div class=highlight><pre style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>(yolov5) ➜  ~ pip install -r requirements.txt
</code></pre></div><p>运行yolov5：</p><pre><code>(yolov5) ➜  yolov5 python detect.py --source 0
</code></pre><p>效果如下：</p><p><img src=https://cdn.yearnfar.com/blog/22/05/7e866c29da33e98d7d2eeea6d25b3af6.png alt=23-07-36屏幕截图></p><hr width=100% id=EOF><p style=color:#777>最后修改于 2022-05-22</p></div></div><nav class=post-pagination><a class=newer-posts href=https://blog.yearnfar.com/posts/%E4%BD%BF%E7%94%A8tinyproxy%E6%90%AD%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/>下回<br>使用tinyproxy搭建代理服务器</a>
<a class=older-posts href=https://blog.yearnfar.com/posts/systemctl%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F/>上回<br>systemctl使用方式</a></nav><div class=post-comment-wrapper><p style=opacity:.6 align=center><small>此篇文章的评论功能已经停用。</small></p></div></div></div></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>移植自 <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
yearnfar 2022</div></div><script src=/js/journal.js></script></body></html>